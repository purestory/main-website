---
description: 
globs: 
alwaysApply: false
---
# Development Workflow

## Project Structure
- **Frontend**: React TypeScript app in `/frontend` directory
- **Backend**: FastAPI service running on port 8001 via systemd
- **Deployment**: Nginx serves static files and proxies API calls

## Development Process
1. **Frontend Changes**: 
   - Edit files in `frontend/src/`
   - Build: `cd frontend && npm run build`
   - No nginx reload needed for static files

2. **Backend Changes**:
   - Edit Python files in backend directory
   - Restart service: `sudo systemctl restart main-website-backend`
   - Check logs: `sudo journalctl -u main-website-backend -f`

3. **Nginx Config Changes**:
   - Edit in `/home/purestory/tmp/` first
   - Test: `sudo nginx -t`
   - Apply: `sudo systemctl reload nginx`

## File Permissions
- Always check permissions before editing: `ls -la [file]`
- Fix ownership: `sudo chown purestory:purestory [file]`
- Never edit root-owned files directly with edit tools

## API Integration
- Frontend calls: Use relative paths `/main-api/...`
- Nginx proxies `/main-api/` to `http://localhost:8001`
- Backend service managed by systemd

## Tech Stack
- **Frontend**: React + TypeScript + Vite
- **Backend**: Node.js + Express + SQLite
- **Server**: nginx reverse proxy + systemd services
- **Build Tool**: Vite for frontend bundling

## Development Rules

### Code Analysis Approach
- **Always verify before assuming**: Read actual code, check logs, analyze errors
- **Step-by-step debugging**: Don't guess, investigate systematically
- **End-to-end verification**: Check from frontend â†’ nginx â†’ backend â†’ database

### File Modification Protocol
1. **Check file permissions first**: `ls -la [filepath]`
2. **Handle root-owned files**: Use tmp directory for editing
3. **Never edit system files directly**: Copy â†’ edit â†’ copy back
4. **Always test changes**: `nginx -t` before applying nginx configs

### Port Management
- **Frontend Dev**: Port 8880 (Vite dev server)
- **Backend API**: Port 8001 (systemd service)
- **Nginx**: Port 80/443 (production)
- **Never assume ports**: Always ask user for port specifications

### Build & Deploy Process
```bash
# 1. Build frontend
cd frontend && npm run build

# 2. Test nginx config (if modified)
sudo nginx -t

# 3. Reload nginx
sudo systemctl reload nginx

# 4. Check backend service
sudo systemctl status main-website-backend
```

## Debugging Guidelines

### Console Logging Rules
- **Development**: Use console.log in useEffect hooks only
- **Production**: Remove or minimize console output
- **Never in JSX**: Causes infinite render loops

### Error Investigation
1. **Browser Console**: Check for JavaScript errors
2. **Network Tab**: Verify API calls and responses
3. **Nginx Logs**: `/var/log/nginx/error.log`
4. **Backend Logs**: `journalctl -u main-website-backend -f`

### Common Issues
- **ERR_CONNECTION_REFUSED**: Check nginx proxy configuration
- **Infinite Renders**: Remove console.log from JSX
- **Missing Icons**: Verify import paths from assets folder
- **Dialog Not Showing**: Check Portal vs inline rendering

## ğŸš€ **Main Website ë°°í¬ í”„ë¡œì„¸ìŠ¤**

### âœ… **ì˜¬ë°”ë¥¸ ë°°í¬ ë°©ë²•**
```bash
# 1. Frontend ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd /home/purestory/main-website/frontend

# 2. ë¹Œë“œ ì‹¤í–‰ (ì´ê²ƒë§Œ í•˜ë©´ ë¨!)
npm run build

# 3. ë! nginxê°€ ìë™ìœ¼ë¡œ dist í´ë”ë¥¼ ì„œë¹™í•¨
```

### ğŸ“ **í”„ë¡œì íŠ¸ êµ¬ì¡°**
- **Frontend**: [frontend/](mdc:frontend) - React + TypeScript + Vite
- **Backend**: [backend/](mdc:backend) - FastAPI (Port 8001)
- **Build Output**: `frontend/dist/` - nginxê°€ ì§ì ‘ ì„œë¹™

### ğŸ”§ **Nginx ì„¤ì •**
- **Root**: `frontend/dist` í´ë”ë¥¼ ì§ì ‘ ì„œë¹™
- **API Proxy**: `/main-api/` â†’ `http://localhost:8001`
- **ë¹Œë“œ í›„ ìë™ ë°˜ì˜**: ë³„ë„ ë³µì‚¬ ì‘ì—… ë¶ˆí•„ìš”

### âŒ **í•˜ì§€ ë§ ê²ƒ**
1. **dist íŒŒì¼ì„ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ ë³µì‚¬í•˜ì§€ ë§ˆë¼**
2. **nginx ì„¤ì •ì„ í•¨ë¶€ë¡œ ê±´ë“œë¦¬ì§€ ë§ˆë¼**
3. **ê¶Œí•œ ë¬¸ì œ ì‹œ sudo chownìœ¼ë¡œ í•´ê²°**

### ğŸ¯ **ê°œë°œ ì‹œ ì£¼ì˜ì‚¬í•­**
- CSS/JS ë³€ê²½ â†’ `npm run build` â†’ ì¦‰ì‹œ ë°˜ì˜
- ìºì‹œ ë¬¸ì œ ì‹œ ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ (Ctrl+F5)
- ì—ëŸ¬ ì‹œ ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì½˜ì†” í™•ì¸
